# ğŸ¨ AI Agent Conversation Flow - Visual Guide

---

## ğŸ“Š Complete Conversation Flowchart

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                             â•‘
â•‘                    USER VISITS /citizen-chat                               â•‘
â•‘                            â†“                                                â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ PHASE 1: GREETING (Message 1)                                       â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ BOT MESSAGE:                                                         â”‚   â•‘
â•‘  â”‚ "ğŸ‘‹ Hello! I'm the Municipal Services AI Agent.                     â”‚   â•‘
â•‘  â”‚  I'm here to help you report and track civic issues in your area.   â”‚   â•‘
â•‘  â”‚  Whether it's a pothole, garbage problem, streetlight issue...      â”‚   â•‘
â•‘  â”‚  What issue would you like to report today?"                        â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚ TICKET STATUS: âŒ NONE                                              â”‚   â•‘
â•‘  â”‚ ACTION: Waiting for user to describe issue                          â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                            â†“                                                â•‘
â•‘                    USER TYPES ISSUE                                        â•‘
â•‘                            â†“                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ PHASE 2: INITIAL DESCRIPTION (Message 2)                           â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ USER MESSAGE:                                                        â”‚   â•‘
â•‘  â”‚ "There's a big pothole on Andheri West road blocking traffic"       â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚ TICKET STATUS: âŒ NONE                                              â”‚   â•‘
â•‘  â”‚ ACTION: Bot will ask clarifying questions                           â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                            â†“                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ PHASE 3: CLARIFYING QUESTIONS (Message 3)                          â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ BOT MESSAGE:                                                         â”‚   â•‘
â•‘  â”‚ "Thank you for reporting this. I understand traffic safety is       â”‚   â•‘
â•‘  â”‚  important. Let me gather a few more details:                       â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚  1. How long has this pothole been there?                           â”‚   â•‘
â•‘  â”‚  2. Is it affecting multiple vehicles or just occasionally?         â”‚   â•‘
â•‘  â”‚  3. Any specific location markers (near shop, intersection, etc)?"   â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚ TICKET STATUS: âŒ NONE                                              â”‚   â•‘
â•‘  â”‚ ACTION: Waiting for user answers                                    â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                            â†“                                                â•‘
â•‘                    USER PROVIDES DETAILS                                   â•‘
â•‘                            â†“                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ PHASE 4: INFO GATHERING (Message 4)                                â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ USER MESSAGE:                                                        â”‚   â•‘
â•‘  â”‚ "It's been there about 3 weeks. Many cars slow down and swerve.    â”‚   â•‘
â•‘  â”‚  It's near the SBI bank on Andheri West."                           â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚ TICKET STATUS: âŒ NONE                                              â”‚   â•‘
â•‘  â”‚ ACTION: Bot will acknowledge and may ask final clarification        â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                            â†“                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ PHASE 5: SUMMARY & TICKET (Message 5-6)                            â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ BOT MESSAGE:                                                         â”‚   â•‘
â•‘  â”‚ "Perfect. I've documented the following:                            â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚  ğŸ“ LOCATION: Andheri West, near SBI bank                           â”‚   â•‘
â•‘  â”‚  â° DURATION: 3 weeks                                               â”‚   â•‘
â•‘  â”‚  ğŸš— IMPACT: Multiple vehicles affected daily                        â”‚   â•‘
â•‘  â”‚  ğŸ”´ SEVERITY: HIGH                                                  â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚  Your complaint has been REGISTERED.                                â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚  ğŸ« TICKET NUMBER: MUM-CIVIC-2025-47391                             â”‚   â•‘
â•‘  â”‚  â±ï¸  EXPECTED RESOLUTION: 24-48 hours                              â”‚   â•‘
â•‘  â”‚  ğŸ‘¤ NEXT ACTION: A field officer will be assigned within 24 hours   â”‚   â•‘
â•‘  â”‚  ğŸ“± UPDATE: You'll receive an SMS update at each stage              â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚  Thank you for keeping Mumbai safe!"                                â”‚   â•‘
â•‘  â”‚                                                                      â”‚   â•‘
â•‘  â”‚ TICKET STATUS: âœ… GENERATED!                                        â”‚   â•‘
â•‘  â”‚ TICKET NUMBER: MUM-CIVIC-2025-47391                                 â”‚   â•‘
â•‘  â”‚ SEVERITY: HIGH (ğŸ”´ Red Badge)                                       â”‚   â•‘
â•‘  â”‚ ACTION: Case History tab updated                                    â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                            â†“                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ CASE HISTORY TAB NOW SHOWS:                                         â”‚   â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘  â”‚ âœ“ Your Case Report                                                  â”‚   â•‘
â•‘  â”‚ âœ“ Ticket: MUM-CIVIC-2025-47391                                      â”‚   â•‘
â•‘  â”‚ âœ“ Location: Not specified (user didn't fill form)                   â”‚   â•‘
â•‘  â”‚ âœ“ Category: (auto-detected from issue)                              â”‚   â•‘
â•‘  â”‚ âœ“ Issue Description: Pothole details from chat                      â”‚   â•‘
â•‘  â”‚ âœ“ Severity Badge: HIGH ğŸ”´                                           â”‚   â•‘
â•‘  â”‚ âœ“ Next Steps listed                                                 â”‚   â•‘
â•‘  â”‚ âœ“ Tracking Information visible                                      â”‚   â•‘
â•‘  â”‚ âœ“ Status: Registered                                                â”‚   â•‘
â•‘  â”‚ âœ“ Priority: High                                                    â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ¯ Message Count vs Ticket Generation

```
Message #  | Sender | Content                      | Ticket Status
-----------|--------|------------------------------|---------------
1          | BOT    | Greeting                     | âŒ None
2          | USER   | Describes issue              | âŒ None
3          | BOT    | Asks clarifying questions    | âŒ None
4          | USER   | Provides details             | âŒ None
5          | BOT    | Acknowledges, asks more      | âŒ None (at 5)
6          | USER   | Additional info or confirms  | âœ… GENERATED!
           |        |                              | (when bot says
           |        |                              |  "registered")
```

**Key:** Ticket only generates when:
- Message count â‰¥ 5 AND
- Bot response contains "ticket" / "registered" / "ticket number"

---

## ğŸ”„ Different Scenarios

### Scenario 1: Normal Civic Issue âœ…

```
â”Œâ”€ USER: "Pothole on my street"
â”‚  â†“
â”œâ”€ BOT: "Tell me more... how long? affecting traffic?"
â”‚  â†“
â”œâ”€ USER: "3 weeks, blocking traffic near market"
â”‚  â†“
â”œâ”€ BOT: "Got it... your complaint is registered"
â”‚  â†“
â””â”€ âœ… TICKET GENERATED: MUM-CIVIC-2025-XXXXX
```

### Scenario 2: Out-of-Scope Question âŒ

```
â”Œâ”€ USER: "What's your favorite food?"
â”‚  â†“
â”œâ”€ BOT: "I don't have food preferences, but I'm here
â”‚         to help with civic issues like potholes,
â”‚         garbage, water problems. Do you have one?"
â”‚  â†“
â”œâ”€ USER: "Actually, my water pipe burst"
â”‚  â†“
â”œâ”€ BOT: (starts gathering info on water issue)
â”‚  â†“
â””â”€ âœ… TICKET GENERATED (after sufficient info)
```

### Scenario 3: Multiple Issues ğŸ“‹

```
â”Œâ”€ USER: "Pothole AND broken streetlight on my street"
â”‚  â†“
â”œâ”€ BOT: "I can help with both. Which is more urgent
â”‚         for your safety?"
â”‚  â†“
â”œâ”€ USER: "The pothole, it's blocking traffic"
â”‚  â†“
â”œâ”€ BOT: (gathers details on pothole first)
â”‚  â†“
â”œâ”€ BOT: "Pothole registered. Want to report the 
â”‚         streetlight now?"
â”‚  â†“
â””â”€ âœ… TICKET GENERATED: MUM-CIVIC-2025-XXXXX (pothole)
   âœ… TICKET GENERATED: MUM-CIVIC-2025-XXXXY (light)
```

---

## ğŸ§  Bot Decision Tree

```
                    USER SENDS MESSAGE
                           â”‚
                           â†“
                    [Count Messages]
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                < 5 msgs      â‰¥ 5 msgs
                    â”‚             â”‚
              [No Ticket]    [Check Response]
              [Ask Questions]     â”‚
                    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      â”‚                     â”‚
              Return   Contains "ticket",   Doesn't contain
              Message   "registered",          keywords
                        "ticket number"?        â”‚
                        â”‚                    [No Ticket]
                        â”œâ”€ YES                  â”‚
                        â”‚  â†“                 Return Message
                    [GENERATE TICKET]
                    [Show Ticket #]
                    [Update Case History]
                    [Return Message + Ticket]
```

---

## ğŸ“± UI Changes During Conversation

### Initial State (Page Load)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Agent        Case History    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ‘‹ Hello! I'm Municipal...      â”‚
â”‚                                 â”‚
â”‚ What issue would you like...    â”‚
â”‚                                 â”‚
â”‚ [________________]  [Send]      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Issue Description
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Agent        Case History    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ‘‹ Hello! I'm Municipal...      â”‚
â”‚                                 â”‚
â”‚ YOU: There's a pothole...       â”‚
â”‚                                 â”‚
â”‚ BOT: Thank you! Tell me more... â”‚
â”‚ 1. How long?                    â”‚
â”‚ 2. Affecting traffic?           â”‚
â”‚                                 â”‚
â”‚ [________________]  [Send]      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Ticket Generated âœ…
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Agent        Case History    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ BOT: ...registered...           â”‚
â”‚ ğŸ« Ticket: MUM-CIVIC-2025-###   â”‚
â”‚ ğŸ”´ Priority: HIGH               â”‚
â”‚                                 â”‚
â”‚ [Case History Button Highlighted]
â”‚                                 â”‚
â”‚ [________________]  [Send]      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ Click Case History
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Agent        Case History âœ“  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ Your Case Report                â”‚
â”‚ Ticket: MUM-CIVIC-2025-###      â”‚
â”‚ ğŸ”´ Priority: HIGH               â”‚
â”‚ Status: Registered              â”‚
â”‚ Location: Not specified         â”‚
â”‚ Description: Pothole details    â”‚
â”‚ Next Steps: Officer will be...  â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Ticket Generation Timeline

```
Timeline:  0s        5s        10s       15s       20s
           â”‚         â”‚         â”‚         â”‚         â”‚
Message 1: BOT GREETS
Message 2:           USER TYPES & SENDS
           â”‚                          
Response:                             BOT RESPONDS (2-3s)
                                       â”‚
Message 3:                             âœ… RECEIVED
                                       âŒ NO TICKET
           â”‚                  â”‚
Message 4:                    USER TYPES DETAILS
           â”‚                            â”‚
Response:                               BOT RESPONDS (2-3s)
                                        â”‚
Message 5:                              âœ… RECEIVED
                                        âŒ STILL NO TICKET
           â”‚         â”‚         â”‚        â”‚         â”‚
Message 6:          USER PROVIDES FINAL INFO
           â”‚                            â”‚
Response:                               BOT RESPONDS (2-3s)
                                        â”‚
Message 7:                              âœ… RECEIVED
           â”‚         â”‚         â”‚        â”‚         â”‚ âœ… TICKET!
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           Total time: ~20-30 seconds (+ user thinking)
```

---

## ğŸ« Ticket Generation Conditions

```
CONDITION 1: Response Keywords
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BOT Response must contain ONE of:
  â€¢ "ticket"
  â€¢ "registration"
  â€¢ "registered"
  â€¢ "ticket number"
  â€¢ "your reference"

Example responses that trigger:
âœ… "Your complaint has been registered"
âœ… "Ticket number: MUM-CIVIC-2025-XXXXX"
âœ… "Your issue is now registered in our system"
âœ… "Here's your reference number"

Example responses that DON'T trigger:
âŒ "Tell me more about this..."
âŒ "Thank you for reporting. How long has this...?"
âŒ "I understand your concern..."


CONDITION 2: Conversation Length
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total messages in chat must be â‰¥ 5:

Message 1: BOT greeting
Message 2: USER description
Message 3: BOT questions
Message 4: USER details
Message 5: BOT response (might not trigger yet)
Message 6: USER more info
Message 7: BOT with "registered" â†’ âœ… TRIGGER!

Both conditions must be TRUE:
  Keyword Match AND Message Count â‰¥ 5
```

---

## ğŸ¯ Expected Behavior Matrix

```
User Input              | Bot Should Do              | Ticket?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"Hi"                   | Greet back, ask issue      | âŒ
"Pothole on street"    | Acknowledge, ask questions | âŒ
"Near market, 2 weeks" | Ask about impact           | âŒ
"Yes, affecting cars"  | Summarize, assess severity | âŒ
"Fix it please"        | Register + provide ticket  | âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"What's the weather"   | Brief answer, redirect     | âŒ
"How old are you"      | Redirect to civic issues   | âŒ
"Tell me a joke"       | Redirect to civic issues   | âŒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"Two potholes"         | Ask which is urgent        | âŒ
"The first one"        | Gather info on first       | âœ… (1st)
"Report second too"    | Gather info on second      | âœ… (2nd)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ğŸ” Code Flow Diagram

```
USER SENDS MESSAGE
        â”‚
        â†“
ADD TO CHAT DISPLAY
        â”‚
        â†“
SET LOADING = TRUE
        â”‚
        â†“
CALL sendMessageToGemini()
        â”‚
        â”œâ”€ SEND: Message + History
        â”œâ”€ SEND: System Prompt (conversation flow)
        â”œâ”€ RECEIVE: AI Response (2-3s)
        â”‚
        â†“
EXTRACT SEVERITY (if ticket)
        â”‚
        â†“
CHECK: "ticket"/"registered" in response
        AND messages.length â‰¥ 5
        â”‚
        â”œâ”€ YES: shouldGenerateTicket = TRUE
        â”‚  â”œâ”€ generateTicketNumber()
        â”‚  â”œâ”€ onCaseCreated callback
        â”‚  â”œâ”€ Update Case History
        â”‚  â””â”€ Display ticket in message
        â”‚
        â””â”€ NO: shouldGenerateTicket = FALSE
           â””â”€ Display response without ticket
        â”‚
        â†“
APPEND MESSAGE TO CHAT
        â”‚
        â†“
AUTO-SCROLL TO LATEST
        â”‚
        â†“
SET LOADING = FALSE
        â”‚
        â†“
READY FOR NEXT MESSAGE
```

---

## âœ¨ Summary

**Old Flow (Broken):**
```
User â†’ Greeting â†’ Ticket (wrong!)
```

**New Flow (Fixed):**
```
User â†’ Greet â†’ Ask Questions â†’ Gather Info â†’ Generate Ticket
```

**Key Improvement:**
- Conversation flows naturally
- Bot asks clarifying questions
- Ticket generated at right time
- Better issue resolution
- More professional experience

---

**Ready to Test!** ğŸš€

`npm run dev` â†’ `http://localhost:8080/citizen-chat`

